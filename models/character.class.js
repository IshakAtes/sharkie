class Character extends MovableObject {
    images_IDLE = [
        './img/1.Sharkie/1.IDLE/1.png',
        './img/1.Sharkie/1.IDLE/2.png',
        './img/1.Sharkie/1.IDLE/3.png',
        './img/1.Sharkie/1.IDLE/4.png',
        './img/1.Sharkie/1.IDLE/5.png',
        './img/1.Sharkie/1.IDLE/6.png',
        './img/1.Sharkie/1.IDLE/7.png',
        './img/1.Sharkie/1.IDLE/8.png',
        './img/1.Sharkie/1.IDLE/9.png',
        './img/1.Sharkie/1.IDLE/10.png',
        './img/1.Sharkie/1.IDLE/11.png',
        './img/1.Sharkie/1.IDLE/12.png',
        './img/1.Sharkie/1.IDLE/13.png',
        './img/1.Sharkie/1.IDLE/14.png',
        './img/1.Sharkie/1.IDLE/15.png',
        './img/1.Sharkie/1.IDLE/16.png',
        './img/1.Sharkie/1.IDLE/17.png',
        './img/1.Sharkie/1.IDLE/18.png',
    ];
    images_GAMEOVER = [
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00011.png',
    ];
    images_DEAD = [
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00000.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00001.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00002.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00003.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00004.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00005.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00006.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00007.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00008.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00009.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00010.png',
        './img/1.Sharkie/6.dead/1.Poisoned/sin subir/DES 2_00011.png',
    ];
    images_HURT = [
        './img/1.Sharkie/5.Hurt/1.Poisoned/1.png',
        './img/1.Sharkie/5.Hurt/1.Poisoned/2.png',
        './img/1.Sharkie/5.Hurt/1.Poisoned/3.png',
        './img/1.Sharkie/5.Hurt/1.Poisoned/4.png',
        './img/1.Sharkie/5.Hurt/1.Poisoned/5.png',
    ];
    images_SWIM = [
        './img/1.Sharkie/3.Swim/1.png',
        './img/1.Sharkie/3.Swim/2.png',
        './img/1.Sharkie/3.Swim/3.png',
        './img/1.Sharkie/3.Swim/4.png',
        './img/1.Sharkie/3.Swim/5.png',
        './img/1.Sharkie/3.Swim/6.png',
    ];
    images_BUBBLE = [
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/1.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/2.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/3.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/4.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/5.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/6.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/7.png',
        './img/1.Sharkie/4.Attack/Bubble trap/op1 (with bubble formation)/8.png',
    ];
    images_POISENBUBBLE = [
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/1.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/2.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/3.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/4.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/5.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/6.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/7.png',
        './img/1.Sharkie/4.Attack/Bubble trap/For Whale/8.png',
    ];
    images_FINSLAP = [
        './img/1.Sharkie/4.Attack/Fin slap/1.png',
        './img/1.Sharkie/4.Attack/Fin slap/2.png',
        './img/1.Sharkie/4.Attack/Fin slap/3.png',
        './img/1.Sharkie/4.Attack/Fin slap/4.png',
        './img/1.Sharkie/4.Attack/Fin slap/5.png',
        './img/1.Sharkie/4.Attack/Fin slap/6.png',
        './img/1.Sharkie/4.Attack/Fin slap/7.png',
        './img/1.Sharkie/4.Attack/Fin slap/8.png',
    ];
    images_GOSLEEP = [
        './img/1.Sharkie/2.Long_IDLE/i1.png',
        './img/1.Sharkie/2.Long_IDLE/I2.png',
        './img/1.Sharkie/2.Long_IDLE/I3.png',
        './img/1.Sharkie/2.Long_IDLE/I4.png',
        './img/1.Sharkie/2.Long_IDLE/I5.png',
        './img/1.Sharkie/2.Long_IDLE/I6.png',
        './img/1.Sharkie/2.Long_IDLE/I7.png',
        './img/1.Sharkie/2.Long_IDLE/I8.png',
        './img/1.Sharkie/2.Long_IDLE/I9.png',
        './img/1.Sharkie/2.Long_IDLE/I10.png',
        './img/1.Sharkie/2.Long_IDLE/I11.png',
        './img/1.Sharkie/2.Long_IDLE/I12.png',
        './img/1.Sharkie/2.Long_IDLE/I13.png',
        './img/1.Sharkie/2.Long_IDLE/I14.png',
    ];
    images_SLEEP = [
        './img/1.Sharkie/2.Long_IDLE/I11.png',
        './img/1.Sharkie/2.Long_IDLE/I12.png',
        './img/1.Sharkie/2.Long_IDLE/I13.png',
        './img/1.Sharkie/2.Long_IDLE/I14.png',
    ];
    world;
    speed = 8;
    gameOver = false;
    wonTheGame = false;
    swimming_Sound = new Audio('sounds/swimmingFish.mp3');
    gameOver_Sound = new Audio('sounds/loose.mp3');
    bubbleAnimationInProgress = false;
    poisenBubbleAttackActive = false;
    bubbleAttackActive = false;
    stopMoveRight = false;
    stopMoveLeft = false;
    stopMoveUp = false;
    stopMoveDown = false;
    longWait = false;
    characterIsSleeping = false;
    wakeUp = true;
    snoring_Sound = new Audio('sounds/snoring.mp3')
    offset = {top: 68, bottom: 99, left: 30, right: 58};
    /**
     * @typedef {object} world
     * @param {number} speed how fast Sharkie Swim
     * @param {boolean} gameOver Show if you die or not
     * @param {boolean} wonTheGame Show if you Won the game
     * @param {sound} swimming_Sound Contains the link to the sound file
     * @param {sound} gameOver Contains the link to the sound file
     * @param {boolean} bubbleAnimationInProgress
     * @param {boolean} poisenBubbleAttackActive
     * @param {boolean} bubbleAttackActive
     * @param {boolean} stopMoveRight
     * @param {boolean} stopMoveLeft
     * @param {boolean} stopMoveUp
     * @param {boolean} stopMoveDown
     * @param {boolean} longWait
     * @param {boolean} characterIsSleeping
     * @param {boolean} wakeUp Show if Character sleep or not
     * @param {sound} snoring_Sound Contains the link to the sound file
     * @typedef {object} offset
     */

    /**
     * The constructor is always executed first when the structure is called
     */
    constructor(){
        super().loadImage('./img/1.Sharkie/1.IDLE/1.png');
        this.loadImages(this.images_IDLE);
        this.loadImages(this.images_GAMEOVER);
        this.loadImages(this.images_DEAD);
        this.loadImages(this.images_HURT);
        this.loadImages(this.images_SWIM);
        this.loadImages(this.images_POISENBUBBLE);
        this.loadImages(this.images_BUBBLE);
        this.loadImages(this.images_FINSLAP);
        this.loadImages(this.images_GOSLEEP);
        this.loadImages(this.images_SLEEP);
        this.bubbleAttackInProgress = false;
        this.animate();
    }


    /**
     * This function set the Intervall, how fast the character Animated
     */
    animate() {
        setInterval(() => this.playCharacter(), 100);
        setInterval(() => this.moveCharacter(), 30);
    }


    /**
     * This function Contain how the Character Animated and play
     */
    playCharacter() {
        this.swimming_Sound.pause();
        if (this.gameOver) {
            this.gameIsOver();
        } else if (this.isDead()) {
            this.characterIsDead();
        } else if(this.isHurt()) {
            this.playAnimation(this.images_HURT);
        } else if (this.poisenBubbleAttackActive) {
            this.AttackWithPoisen();
        } else if (this.bubbleAttackActive) {
            this.BubbleAttack();
        } else if (this.finslap) {
            this.characterFinslap();
        } else
            this.characterStandSleepOrMove();
    }

    /**
     * This function Contain how the Character sleep
     */
    characterStandSleepOrMove() {
        if (this.world.keyboard.RIGHT || this.world.keyboard.LEFT || this.world.keyboard.UP || this.world.keyboard.DOWN) {
            this.swimAnimation();
        } else if (this.characterIsSleeping && !this.wakeUp) {
            this.sharkieSleeped();
        } else if (this.longWait && !this.wakeUp) {
            this.sharkieGoesSleep();
        } else {
            this.characterStands();
        }
    }


    /**
     * This function show if sharkie is in deepSleep
     */
    sharkieSleeped() {
        this.playAnimation(this.images_SLEEP);
        if (this.y < 580) {
            this.moveDown();
        }
    }

    /**
     * This function show how Sharkie go Sleep
     * 
     * @param {boolean} audioOn Contain if Audio is On or Off
     */
    sharkieGoesSleep() {
        if (!this.wakeUp && !this.characterIsSleeping) {
            this.playAnimation(this.images_GOSLEEP);
            if (audioOn) {
                this.snoring_Sound.play();
                this.snoring_Sound.loop = true;
            }
            this.sleepTimer = setTimeout(() => {
                this.characterIsSleeping = true;
                this.longWait = false;
            }, this.images_GOSLEEP.length * 80);
            if (this.y < 580) {
                this.moveDown();
            }
        }
    }

    /**
     * This function show Sharkie if he stay
     */
    characterStands() {
        this.playAnimation(this.images_IDLE);
        if (this.wakeUp && !this.goSleepTimer) {
            const startTime = new Date().getTime();
            const duration = 15000;
            const endTime = startTime + duration;
            this.goSleepTimer = setTimeout(() => {
                this.longWait = true;
                this.wakeUp = false;
            }, endTime - (new Date().getTime()));
        }
    }

    /**
     * This function show how Sharkie Swim
     */
    swimAnimation() {
        this.wakeSharkie();
        this.playAnimation(this.images_SWIM);
        if (audioOn) {
            this.swimming_Sound.play();
        }
    }

    /**
     * This function awakens the character and Clear some Timer
     */
    wakeSharkie() {
        this.snoring_Sound.pause();
        this.wakeUp = true;
        this.characterIsSleeping = false;
        clearTimeout(this.goSleepTimer);
        this.goSleepTimer = null;
        clearTimeout(this.sleepTimer);
        this.sleepTimer = null;
    }

    /**
     * This function shows the Finslap attack
     */
    characterFinslap() {
        this.wakeSharkie();
        this.playAnimation(this.images_FINSLAP);
        this.world.finSlap();
        setTimeout(() => {
            this.finslap = false;
        }, this.images_FINSLAP.length * 100);
    }

    /**
     * This function Animate the Bubble Attack
     */
    BubbleAttack() {
        this.wakeSharkie();
        this.playAnimation(this.images_BUBBLE);
        if (!this.bubbleAnimationInProgress) {
            this.bubbleAnimationInProgress = true;
            setTimeout(() => {
                this.drawBubble();
                this.bubbleAnimationInProgress = false;
                this.bubbleAttackActive = false;
            }, this.images_BUBBLE.length * 95);
        }
    }

    /**
     * This function Animate the Poisen Bubble Attack
     */
    AttackWithPoisen() {
        this.wakeSharkie();
        this.playAnimation(this.images_POISENBUBBLE);
        if (!this.bubbleAnimationInProgress) {
            this.bubbleAnimationInProgress = true;
            setTimeout(() => {
                this.drawPoisenBubble();
                this.bubbleAnimationInProgress = false;
                this.poisenBubbleAttackActive = false;
            }, this.images_POISENBUBBLE.length * 100);
        }
    }


    /**
     * This function push a bubble in the Array attackingObjects and make the Bubble visible
     */
    drawBubble() {
        if(!this.world.character.otherDirection) {
            let bubble = new AttackObject(this.world.character.x + 122, this.world.character.y + 60);
            this.world.attackingObjects.push(bubble);
        } else if(this.world.character.otherDirection) {
            let bubble = new AttackObject(this.world.character.x + 0, this.world.character.y + 60, this.world.character.otherDirection); //70, 72
            this.world.attackingObjects.push(bubble);
        }
    }


    /**
     * This function push a bubble in the Array attackingObjects and make the Bubble visible
     */
    drawPoisenBubble() {
        if(!this.world.character.otherDirection && this.world.character.myPoisens >= 10) {
            let infectedBubble = new PoisenAttack(this.world.character.x + 122, this.world.character.y + 60);
            this.world.attackingObjects.push(infectedBubble);
            this.world.character.myPoisens -= 10;
            this.world.poisenBar.setPercentage(this.world.character.myPoisens);
        } else if(this.world.character.otherDirection && this.world.character.myPoisens >= 10) {
            let infectedBubble = new PoisenAttack(this.world.character.x + 0, this.world.character.y + 60, this.world.character.otherDirection); //70, 72
            this.world.attackingObjects.push(infectedBubble);
            this.world.character.myPoisens -= 10;
            this.world.poisenBar.setPercentage(this.world.character.myPoisens);
        }
    }

    /**
     * This function Animate the Character if he is Dead
     */
    characterIsDead() {
        this.playAnimation(this.images_DEAD);
            setTimeout(() => {
                this.gameOver = true;
                setTimeout(() => {
                    if (audioOn) {
                        this.gameOver_Sound.play();
                        this.snoring_Sound.pause();
                    }
                }, 1000);
            }, this.images_DEAD.length * 100);
    }

    /**
     * This function ends the game and the sound
     */
    gameIsOver() {
        let gameOverScreen = document.getElementById('gameOverOverlay');
            this.playAnimation(this.images_GAMEOVER);
            this.moveUp();
            setTimeout(() => {
                this.gameOver_Sound.pause();
            }, 6000);
            setTimeout(() => {
                gameOverScreen.style.display = 'flex';
                if (window.innerHeight < 930 && window.innerWidth > 1024) {
                    gameOverScreen.style.top = '20px';
                }
            }, 2000);
    }


    /**
     * This function shows how you can move Sharkie
     */
    moveCharacter() {
        if (!this.stopMoveRight && !this.wonTheGame && !this.gameOver && this.world.keyboard.RIGHT && this.x < this.world.level.level_end_x) {
            this.moveRight();
            this.otherDirection = false;
        }
        if (!this.stopMoveLeft && !this.wonTheGame && !this.gameOver && this.world.keyboard.LEFT && this.x > -814) {
            this.moveLeft();
            this.otherDirection = true;
        }
        this.world.camera_x = -this.x + 200;
        if (!this.stopMoveUp && !this.wonTheGame && !this.gameOver && this.world.keyboard.UP && this.y > -40) {
            this.moveUp();
        }
        if (!this.stopMoveDown && !this.wonTheGame && !this.gameOver && this.world.keyboard.DOWN && this.y < 580) {
            this.moveDown();
        }
        if (!this.wonTheGame && this.world.keyboard.SPACE) {
            this.attackWithBubble();
        }
        if (!this.wonTheGame && this.world.keyboard.B) {
            this.attackWithPoisenBubble();
        }
        if (!this.wonTheGame && this.world.keyboard.V) {
            this.attackWithFinslap();
        }
    }

}